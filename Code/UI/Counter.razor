@using Sandbox;
@using Sandbox.UI;
@inherits PanelComponent

<root>
    <div class="game-hud">
        <div class="state @CurrentState.ToString().ToLower()">
            @CurrentState
        </div>
        <div class="time">
            @if (GameManager.Current?.HasMinimumPlayers() ?? false)
            {
                @FormatTime(Math.Max(0, TimeLeft))
            }
            else if (CurrentState == GameManager.GameState.Intermission)
            {
                <span class="waiting">Waiting for players...</span>
            }
            else
            {
                @FormatTime(Math.Max(0, TimeLeft))
            }
        </div>
    </div>
</root>

@code
{
    public float TimeLeft => GameManager.Current?.CurrentState == GameManager.GameState.Intermission
    ? GameManager.INTERMISSION_DURATION - GameManager.Current.TimeSinceStateStart
    : GameManager.ROUND_DURATION - GameManager.Current.TimeSinceStateStart;

    public GameManager.GameState CurrentState => GameManager.Current?.CurrentState ?? GameManager.GameState.Intermission;

    private string FormatTime(float seconds)
    {
        int minutes = (int)(seconds / 60);
        int secs = (int)(seconds % 60);
        return $"{minutes:00}:{secs:00}";
    }

    protected override int BuildHash() => HashCode.Combine(TimeLeft, CurrentState,
    GameManager.Current?.HasMinimumPlayers());
}